-- ================================================================
-- Ошибочный запрос для PostgreSQL (не учитывает когорты):
-- В PostgreSQL используется функция DATE_TRUNC для округления даты до начала недели.
-- Этот запрос не учитывает когорты, что может привести к ошибочным результатам в анализе retention.

SELECT
    DATE_TRUNC('week', event_time) AS week,  -- Округление даты до начала недели.
    COUNT(DISTINCT user_id) AS active_users  -- Подсчёт уникальных пользователей.
FROM events
GROUP BY 1  -- Группировка по неделям.
ORDER BY 1; -- Сортировка по неделе.

-- =====================================================================

-- Запрос для ClickHouse:
-- В ClickHouse используется функция toStartOfWeek для округления даты до начала недели.
-- Здесь подсчитываются уникальные пользователи с помощью функции countDistinct.

SELECT
    toStartOfWeek(event_time) AS week,  -- Округление даты до начала недели.
    countDistinct(user_id) AS active_users  -- Подсчёт уникальных пользователей.
FROM events
GROUP BY week  -- Группировка по неделям.
ORDER BY week; -- Сортировка по неделе.

