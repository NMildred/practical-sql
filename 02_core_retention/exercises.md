# üü° Level 2 ‚Äî Core Retention (Cohort Analysis)

–≠—Ç–æ—Ç –±–ª–æ–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å—Ç—Ä–æ–∏—Ç—å –∫–æ–≥–æ—Ä—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ —Å—á–∏—Ç–∞—Ç—å retention –ø–æ –Ω–µ–¥–µ–ª—è–º.

‚è± –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –≤—Ä–µ–º—è: 40‚Äì60 –º–∏–Ω—É—Ç  
üéØ –¶–µ–ª—å: –Ω–∞—É—á–∏—Ç—å—Å—è —Å—Ç—Ä–æ–∏—Ç—å retention-–º–∞—Ç—Ä–∏—Ü—ã –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ –ø–æ–¥—Å—á—ë—Ç—É

---

## üìå –ó–∞–¥–∞–Ω–∏–µ 1 ‚Äî –ù–µ–¥–µ–ª—å–Ω—ã–µ –∫–æ–≥–æ—Ä—Ç—ã

–°—Ñ–æ—Ä–º–∏—Ä—É–π—Ç–µ –Ω–µ–¥–µ–ª—å–Ω—ã–µ –∫–æ–≥–æ—Ä—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –¥–∞—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.

–ü–æ–¥—Å–∫–∞–∑–∫–∞: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `toStartOfWeek(signup_date)`  

---

## üìå –ó–∞–¥–∞–Ω–∏–µ 2 ‚Äî Retention –ø–æ –Ω–µ–¥–µ–ª—è–º

–î–ª—è –∫–∞–∂–¥–æ–π –∫–æ–≥–æ—Ä—Ç—ã –ø–æ—Å—á–∏—Ç–∞–π—Ç–µ, —Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–µ—Ä–Ω—É–ª–æ—Å—å –≤ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –Ω–µ–¥–µ–ª–∏.

–ü–æ–¥—Å–∫–∞–∑–∫–∞: —Å–Ω–∞—á–∞–ª–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–≥–æ—Ä—Ç—É, –ø–æ—Ç–æ–º –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.

---

## üìå –ó–∞–¥–∞–Ω–∏–µ 3 ‚Äî Retention —á–µ—Ä–µ–∑ –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

–†–µ—à–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ClickHouse, —á—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —É–¥–µ—Ä–∂–∞–ª–æ—Å—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∏—Ö –∫–æ–≥–æ—Ä—Ç—ã.

---

## üìå –ó–∞–¥–∞–Ω–∏–µ 4 ‚Äî Retention Matrix

–ü–æ—Å—Ç—Ä–æ–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É:

- —Å—Ç—Ä–æ–∫–∏ ‚Äî –∫–æ–≥–æ—Ä—Ç–∞ (–Ω–µ–¥–µ–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)  
- –∫–æ–ª–æ–Ω–∫–∏ ‚Äî –Ω–æ–º–µ—Ä –Ω–µ–¥–µ–ª–∏ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (week 0, week 1, week 2‚Ä¶)  
- –∑–Ω–∞—á–µ–Ω–∏—è ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–µ—Ä–∂–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ü–æ–¥—Å–∫–∞–∑–∫–∞: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `dateDiff('week', cohort_week, activity_week)`  

---

üí° –°–æ–≤–µ—Ç:

- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞—Ç—å naive –≤–µ—Ä—Å–∏—é (`retention_wrong.sql`), –ø–æ—Ç–æ–º –∏—Å–ø—Ä–∞–≤—å—Ç–µ –µ—ë (`retention_correct.sql`)  
- –ù–∞–∫–æ–Ω–µ—Ü, —É–ª—É—á—à–∏—Ç–µ —á–µ—Ä–µ–∑ –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (`retention_window.sql`)  
- –ü–æ—Å—Ç—Ä–æ–π—Ç–µ matrix (`retention_matrix.sql`)
